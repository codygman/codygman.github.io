<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>My Hakyll Blog - Go vs Haskell: Text processing lorem ipsum</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">My Hakyll Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Go vs Haskell: Text processing lorem ipsum</h1>

            <div class="info">
    Posted on December 14, 2014
    
</div>

<p>Inspired by: <a href="http://honza.ca/2012/10/haskell-strings">comparing text processing performance of nodejs, python,</a> and <a href="http://www.reddit.com/r/golang/comments/12196f/simple_text_processing_benchmark_vs_node_python/">golang</a>.</p>
<p><em>File Size</em>:</p>
<pre class="shell"><code>cody@cody-XPS-L521X:~/programming/benchmarks/lorem-ipsum-text-processing/haskell$ ls -larth input.txt 
-rw-rw-r-- 1 cody cody 171M Dec 14 04:37 input.txt</code></pre>
<h2 id="haskell">Haskell</h2>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span>

<span class="kw">import qualified</span> <span class="dt">Data.ByteString</span> <span class="kw">as</span> <span class="dt">B</span>
<span class="kw">import           </span><span class="dt">Data.Word8</span>      (<span class="dt">Word8</span>, isAsciiLower, _cr, _nbsp, _space, _tab)

isSpace<span class="ot"> ::</span> <span class="dt">Word8</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span>
isSpace w <span class="fu">=</span> w <span class="fu">==</span> _space <span class="fu">||</span> w <span class="fu">==</span> _nbsp <span class="fu">||</span> w <span class="fu">&lt;=</span> _cr <span class="fu">&amp;&amp;</span> w <span class="fu">&gt;=</span> _tab

toUpper<span class="ot"> ::</span> <span class="dt">Word8</span> <span class="ot">-&gt;</span> <span class="dt">Word8</span>
toUpper w <span class="fu">=</span> <span class="kw">if</span> isAsciiLower w <span class="kw">then</span> w <span class="fu">-</span> _space <span class="kw">else</span> w

<span class="ot">op ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">Word8</span> <span class="ot">-&gt;</span> (<span class="dt">Bool</span>, <span class="dt">Word8</span>)
op flag c <span class="fu">=</span> <span class="kw">if</span> isSpace c <span class="kw">then</span> (<span class="dt">True</span>,c) <span class="kw">else</span> (<span class="dt">False</span>,d)
<span class="kw">where</span> d <span class="fu">=</span> <span class="kw">if</span> flag <span class="kw">then</span> toUpper c <span class="kw">else</span> c

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> B.readFile <span class="st">&quot;input.txt&quot;</span> <span class="fu">&gt;&gt;=</span> B.putStr <span class="fu">.</span> snd <span class="fu">.</span> B.mapAccumL op <span class="dt">True</span></code></pre>
<pre class="shell"><code>cody@cody-XPS-L521X:~/programming/benchmarks/lorem-ipsum-text-processing/haskell$ time ./.cabal-sandbox/bin/lorem-ipsum-processing &gt; output.txt 

real	0m1.165s
user	0m0.524s
sys	0m0.640s</code></pre>
<h2 id="go">Go</h2>
<pre class="sourceCode go"><code class="sourceCode go"><span class="kw">package</span> main

<span class="kw">import</span> (
  <span class="st">&quot;bytes&quot;</span>
  <span class="st">&quot;os&quot;</span>
  <span class="st">&quot;log&quot;</span>
  <span class="st">&quot;io&quot;</span>
)

<span class="kw">func</span> main() {
  b := <span class="fu">make</span>([]<span class="dt">byte</span>, <span class="dv">4096</span>)
  f, err := os.Open(<span class="st">&quot;large-file.txt&quot;</span>)
  <span class="kw">if</span> err != <span class="ot">nil</span> {
    log.Fatal(<span class="st">&quot;Could not read from large-file.txt&quot;</span>)
  }

  <span class="kw">for</span> {
    <span class="co">// Read from file</span>
    n, err := f.Read(b)
    <span class="kw">if</span> err == io.EOF {
      <span class="kw">break</span>
    } <span class="kw">else</span> <span class="kw">if</span> err != <span class="ot">nil</span> {
      log.Fatal(<span class="st">&quot;An error occurred reading from large-file.txt.&quot;</span>)
    }

    bTitle := bytes.Title(b[<span class="dv">0</span>:n])

    <span class="co">// Write to stdout</span>
    <span class="kw">if</span> _, err := os.Stdout.Write(bTitle); err != <span class="ot">nil</span> {
      log.Fatal(<span class="st">&quot;An error occurred writing to Stdout.&quot;</span>)
    }
  }
}</code></pre>
<pre class="shell"><code>cody@cody-XPS-L521X:~/programming/benchmarks/lorem-ipsum-text-processing/go$ time ./lorem large-file.txt &gt; output.txt

real	0m3.970s
user	0m3.322s
sys	0m0.645s</code></pre>
<h2 id="bonus-very-short-but-not-as-performant-haskell-version">Bonus: Very short (but not as performant Haskell version):</h2>
<pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">import           </span><span class="dt">Data.Char</span>
<span class="kw">import qualified</span> <span class="dt">Data.Text.Lazy</span>    <span class="kw">as</span> <span class="dt">T</span>
<span class="kw">import qualified</span> <span class="dt">Data.Text.Lazy.IO</span> <span class="kw">as</span> <span class="dt">TIO</span>

convert <span class="fu">=</span> T.tail <span class="fu">.</span> T.scanl (\ a b <span class="ot">-&gt;</span> <span class="kw">if</span> isSpace a <span class="kw">then</span> toUpper b <span class="kw">else</span> b) <span class="ch">' '</span>

main <span class="fu">=</span> TIO.readFile <span class="st">&quot;input.txt&quot;</span> <span class="fu">&gt;&gt;=</span> (\fc <span class="ot">-&gt;</span> TIO.putStrLn <span class="fu">$</span> convert fc)</code></pre>
<pre class="shell"><code>cody@cody-XPS-L521X:~/programming/benchmarks/lorem-ipsum-text-processing/haskell$ time ./.cabal-sandbox/bin/lorem-ipsum-processing &gt; output.txt 

real	0m19.787s
user	0m17.910s
sys	0m1.854s</code></pre>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
