<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>My Hakyll Blog - Migrating mysql data across schemas in Django (or anything else)</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">My Hakyll Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Migrating mysql data across schemas in Django (or anything else)</h1>

            <div class="info">
    Posted on May 23, 2013
    
</div>

<p>I’m aware there are solutions made to avoid this, but I found myself in the situation of only having data in mysql backups. Hopefully the following will be useful to others who fall into the same situation.</p>
<h3 id="generate-mysqldump-of-the-remote-database">Generate mysqldump of the remote database:</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">mysqldump</span> -u cody -h corys.dbserver.com -pmypassword name_of_database</code></pre>
<h3 id="create-the-database-on-the-same-server-as-the-database-data-is-being-migrated-to.">Create the database on the same server as the database data is being migrated to.</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">mysqadmin</span> create dump_db</code></pre>
<h3 id="insert-the-data">Insert the data</h3>
<pre class="sourceCode sql"><code class="sourceCode sql">    # <span class="kw">disable</span> <span class="kw">foreign</span> <span class="kw">key</span> checks
    <span class="kw">set</span> foreign_key_checks = <span class="dv">0</span>;

    # <span class="kw">insert</span> <span class="kw">data</span> <span class="kw">and</span> <span class="kw">foreign</span> <span class="kw">key</span> <span class="kw">data</span>
    <span class="kw">insert</span> ignore <span class="kw">into</span> newapp_model <span class="kw">select</span> * <span class="kw">from</span> dump_db.oldapp_model;
    <span class="kw">insert</span> ignore <span class="kw">into</span> newappmodel_modelfield <span class="kw">select</span> * <span class="kw">from</span> dump_db.oldapp_modelfield;

    # <span class="kw">enable</span> <span class="kw">foreign</span> <span class="kw">key</span> checks again
    <span class="kw">set</span> foreign_key_checks = <span class="dv">1</span>;</code></pre>
<h3 id="test-that-the-data-works-in-the-django-shell">Test that the data works in the Django shell</h3>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">python</span> manage.py shell</code></pre>
<pre class="sourceCode python"><code class="sourceCode python">    In [<span class="dv">14</span>]: [g.genre <span class="kw">for</span> g in Movie.objects.<span class="dt">filter</span>(title=<span class="st">&quot;transformers&quot;</span>)[<span class="dv">0</span>].movie_genre.<span class="dt">all</span>()]
    Out[<span class="dv">14</span>]: 
    [&lt;Genre: Action&gt;,
     &lt;Genre: Adventure&gt;,
     &lt;Genre: Science Fiction&gt;,
     &lt;Genre: Thriller&gt;]</code></pre>
<h3 id="last-step-repeat.">Last Step: Repeat.</h3>
<p>There are undoubtedly better ways of doing this, but it didn’t this method didn’t take very long. More importantly, it worked :D</p>

        </div>
        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
